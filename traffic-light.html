<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Traffic Light Redesign Challenge</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @keyframes float {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-10px); }
    }
    .float-animation {
      animation: float 3s ease-in-out infinite;
    }
    @keyframes pulse-glow {
      0%, 100% { box-shadow: 0 0 20px rgba(74, 222, 128, 0.4); }
      50% { box-shadow: 0 0 40px rgba(74, 222, 128, 0.8); }
    }
    .pulse-glow {
      animation: pulse-glow 2s ease-in-out infinite;
    }
    .number-circle-export .number-text {
      transform: translateY(-5px) !important;
    }
  </style>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useRef, useEffect } = React;

    const DrawableCircle = ({ color, onColorFill, selectedColor, size = 45 }) => {
      const canvasRef = useRef(null);
      const [isDrawing, setIsDrawing] = useState(false);
      const [hasDrawing, setHasDrawing] = useState(false);

      useEffect(() => {
        const canvas = canvasRef.current;
        if (canvas) {
          const ctx = canvas.getContext('2d');
          ctx.fillStyle = color;
          ctx.fillRect(0, 0, canvas.width, canvas.height);
          if (color === '#FFFFFF') {
            setHasDrawing(false);
          }
        }
      }, [color]);

      const startDrawing = (e) => {
        if (!selectedColor) {
          setIsDrawing(true);
          draw(e);
        }
      };

      const stopDrawing = () => {
        setIsDrawing(false);
      };

      const getCoordinates = (e) => {
        const canvas = canvasRef.current;
        const rect = canvas.getBoundingClientRect();
        const scaleX = canvas.width / rect.width;
        const scaleY = canvas.height / rect.height;
        
        if (e.touches) {
          return {
            x: (e.touches[0].clientX - rect.left) * scaleX,
            y: (e.touches[0].clientY - rect.top) * scaleY
          };
        }
        return {
          x: (e.clientX - rect.left) * scaleX,
          y: (e.clientY - rect.top) * scaleY
        };
      };

      const draw = (e) => {
        if (!isDrawing && e.type !== 'mousedown' && e.type !== 'touchstart') return;
        if (selectedColor) return;
        
        e.preventDefault();
        const canvas = canvasRef.current;
        const ctx = canvas.getContext('2d');
        const { x, y } = getCoordinates(e);

        ctx.fillStyle = '#000000';
        ctx.beginPath();
        ctx.arc(x, y, 2.5, 0, Math.PI * 2);
        ctx.fill();
        setHasDrawing(true);
      };

      const handleClick = (e) => {
        if (selectedColor) {
          onColorFill();
        }
      };

      const clearCanvas = () => {
        const canvas = canvasRef.current;
        const ctx = canvas.getContext('2d');
        ctx.fillStyle = color;
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        setHasDrawing(false);
      };

      return (
        <div className="relative group">
          <canvas
            ref={canvasRef}
            width={size * 2}
            height={size * 2}
            onClick={handleClick}
            onMouseDown={startDrawing}
            onMouseMove={draw}
            onMouseUp={stopDrawing}
            onMouseLeave={stopDrawing}
            onTouchStart={startDrawing}
            onTouchMove={draw}
            onTouchEnd={stopDrawing}
            className="rounded-full border-3 border-gray-800 cursor-crosshair transition-all hover:scale-110 hover:shadow-xl"
            style={{ 
              backgroundColor: color,
              touchAction: 'none',
              width: size + 'px',
              height: size + 'px'
            }}
          />
          {hasDrawing && (
            <button
              onClick={clearCanvas}
              className="absolute -top-1 -right-1 w-5 h-5 bg-red-500 text-white rounded-full text-xs hover:bg-red-600 shadow-lg opacity-0 group-hover:opacity-100 transition-opacity"
              title="Clear drawing"
            >
              √ó
            </button>
          )}
        </div>
      );
    };

    const TrafficLightApp = () => {
      const colors = [
        '#E63946', '#6BBE5B', '#F7C548', '#3D5A97', 
        '#BBAD47', '#A94E8C', '#D9862E', '#B8BCE8',
        '#B87A80', '#6D7B94', '#D08AB5', '#F3EDAF',
        '#CFCFCF', '#8B8B8B', '#5A5A5A', '#A8D4A0',
        '#4DB5C1', '#8C8231'
      ];

      const [selectedColor, setSelectedColor] = useState(null);
      const [lights, setLights] = useState({
        1: ['#FFFFFF', '#FFFFFF', '#FFFFFF'],
        2: ['#FFFFFF', '#FFFFFF', '#FFFFFF'],
        3: ['#FFFFFF', '#FFFFFF', '#FFFFFF']
      });
      const trafficLightsRef = useRef(null);

      const handleColorSelect = (color) => {
        if (selectedColor === color) {
          setSelectedColor(null);
        } else {
          setSelectedColor(color);
        }
      };

      const fillLight = (lightNum, position) => {
        if (selectedColor) {
          setLights(prev => ({
            ...prev,
            [lightNum]: prev[lightNum].map((color, idx) => 
              idx === position ? selectedColor : color
            )
          }));
        }
      };

      const resetLights = () => {
        setLights({
          1: ['#FFFFFF', '#FFFFFF', '#FFFFFF'],
          2: ['#FFFFFF', '#FFFFFF', '#FFFFFF'],
          3: ['#FFFFFF', '#FFFFFF', '#FFFFFF']
        });
      };

      const exportAsPNG = async () => {
        const element = trafficLightsRef.current;
        if (!element) return;

        // Hide buttons and bottom text before export
        const buttons = element.querySelector('.export-buttons');
        const bottomText = element.querySelector('.bottom-instruction');
        if (buttons) buttons.style.display = 'none';
        if (bottomText) bottomText.style.display = 'none';

        // Create wrapper with padding for export
        const wrapper = document.createElement('div');
        wrapper.style.padding = '30px';
        wrapper.style.backgroundColor = '#1e1b4b';
        wrapper.style.display = 'inline-block';
        
        const clone = element.cloneNode(true);
        
        // Copy canvas content from original to clone
        const originalCanvases = element.querySelectorAll('canvas');
        const clonedCanvases = clone.querySelectorAll('canvas');
        originalCanvases.forEach((originalCanvas, index) => {
          const clonedCanvas = clonedCanvases[index];
          const ctx = clonedCanvas.getContext('2d');
          ctx.drawImage(originalCanvas, 0, 0);
        });
        
        // Add export class to number circles in clone
        const numberCircles = clone.querySelectorAll('.number-circle');
        numberCircles.forEach(circle => circle.classList.add('number-circle-export'));
        
        wrapper.appendChild(clone);
        document.body.appendChild(wrapper);

        const script = document.createElement('script');
        script.src = 'https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js';
        
        script.onload = async () => {
          const canvas = await html2canvas(wrapper, {
            backgroundColor: '#1e1b4b',
            scale: 2,
            logging: false
          });
          
          // Clean up
          document.body.removeChild(wrapper);
          if (buttons) buttons.style.display = 'flex';
          if (bottomText) bottomText.style.display = 'block';
          
          canvas.toBlob((blob) => {
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            const timestamp = new Date().toISOString().slice(0, 19).replace(/:/g, '-');
            link.download = `traffic-lights-${timestamp}.png`;
            link.href = url;
            link.click();
            URL.revokeObjectURL(url);
          });
        };
        
        document.head.appendChild(script);
      };

      return (
        <div className="min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 py-6 px-4 overflow-auto">
          <div className="max-w-6xl mx-auto">
            {/* Header */}
            <div className="text-center mb-6">
              <h1 className="text-4xl font-bold text-white mb-2 bg-gradient-to-r from-green-400 via-emerald-400 to-teal-400 bg-clip-text text-transparent">
                Redesign this traffic light for everyone.
              </h1>
              <p className="text-slate-300 text-base">A colorblind accessibility challenge</p>
            </div>

            <div className="grid lg:grid-cols-3 gap-5">
              {/* Instructions Panel */}
              <div className="lg:col-span-1">
                <div className="bg-white/10 backdrop-blur-xl p-5 rounded-2xl shadow-2xl border border-white/20 hover:border-white/40 transition-all">
                  <div className="bg-white/5 backdrop-blur-sm rounded-xl p-4 mb-4">
                    <h2 className="text-2xl font-bold text-white mb-4">Instructions</h2>
                    
                    <div className="space-y-3 text-white text-sm">
                      <div className="bg-white/20 backdrop-blur rounded-lg p-3 hover:bg-white/30 transition-all">
                        <div className="font-bold flex items-start gap-2">
                          <span className="text-xl">1.</span>
                          <span>Click on a color followed by an empty fixture to fill in the traffic light to reflect how you think those with colour-blindness perceive them.</span>
                        </div>
                      </div>

                      <div className="bg-white/20 backdrop-blur rounded-lg p-3 hover:bg-white/30 transition-all">
                        <div className="font-bold flex items-start gap-2">
                          <span className="text-xl">2.</span>
                          <span>Use the colours to redesign the traffic light to how you could accommodate those with colour-blindness.</span>
                        </div>
                      </div>

                      <div className="bg-white/20 backdrop-blur rounded-lg p-3 hover:bg-white/30 transition-all">
                        <div className="font-bold flex items-start gap-2">
                          <span className="text-xl">3.</span>
                          <span>Use Draw Mode (deselect the current colour) to draw a solution that might help distinguish the different states of a traffic light.</span>
                        </div>
                      </div>
                    </div>
                  </div>

                  {/* Example Traffic Light */}
                  <div className="flex justify-center">
                    <div className="flex flex-col items-center">
                      <div className="bg-gray-900 rounded-3xl p-3 flex flex-col gap-2 shadow-2xl border-2 border-gray-700">
                        <div className="w-11 h-11 rounded-full bg-red-500 border-3 border-gray-800 shadow-lg"></div>
                        <div className="w-11 h-11 rounded-full bg-yellow-400 border-3 border-gray-800 shadow-lg"></div>
                        <div className="w-11 h-11 rounded-full bg-green-500 border-3 border-gray-800 shadow-lg"></div>
                      </div>
                      <div className="w-2 h-12 bg-gradient-to-b from-gray-700 to-gray-800 mt-1"></div>
                      <div className="w-16 h-2 bg-gradient-to-b from-green-600 to-green-700 rounded-t shadow-lg"></div>
                    </div>
                  </div>
                </div>
              </div>

              {/* Main Content */}
              <div className="lg:col-span-2 space-y-5">
                {/* Color Palette */}
                <div className="bg-white/10 backdrop-blur-xl p-4 rounded-2xl shadow-2xl border border-white/20 hover:border-white/40 transition-all">
                  <h3 className="text-xl font-bold text-white mb-3 text-center">Color Palette</h3>
                  <div className="grid grid-cols-6 gap-2 mb-3">
                    {colors.map((color, idx) => (
                      <button
                        key={idx}
                        onClick={() => handleColorSelect(color)}
                        className={`w-10 h-10 rounded-full transition-all hover:scale-110 shadow-lg hover:shadow-2xl ${
                          selectedColor === color ? 'ring-4 ring-white scale-110 shadow-2xl' : ''
                        }`}
                        style={{ backgroundColor: color }}
                      />
                    ))}
                  </div>
                  {selectedColor ? (
                    <div className="text-center text-xs text-white bg-white/10 rounded-lg py-2 backdrop-blur">
                      Selected: <span className="font-mono font-bold">{selectedColor}</span>
                      <div className="text-xs mt-0.5 text-green-300">Click color again to enter draw mode</div>
                    </div>
                  ) : (
                    <div className="text-center text-xs text-green-300 font-bold bg-white/10 rounded-lg py-2 backdrop-blur">
                      ‚úèÔ∏è Draw mode active - Click and drag on circles
                    </div>
                  )}
                </div>

                {/* Traffic Lights */}
                <div className="bg-white/10 backdrop-blur-xl p-5 rounded-2xl shadow-2xl border border-white/20 hover:border-white/40 transition-all" ref={trafficLightsRef}>
                  <div className="flex justify-between items-center mb-5">
                    <h3 className="text-xl font-bold text-white">Your Redesigns</h3>
                    <div className="flex gap-2 export-buttons">
                      <button
                        onClick={exportAsPNG}
                        className="px-4 py-2 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-xl hover:from-green-600 hover:to-emerald-700 font-semibold shadow-lg transition-all hover:scale-105 text-sm"
                      >
                        üì∏ Export
                      </button>
                      <button
                        onClick={resetLights}
                        className="px-4 py-2 bg-gradient-to-r from-red-500 to-pink-600 text-white rounded-xl hover:from-red-600 hover:to-pink-700 font-semibold shadow-lg transition-all hover:scale-105 text-sm"
                      >
                        üîÑ Reset
                      </button>
                    </div>
                  </div>
                  <div className="flex gap-8 justify-center flex-wrap">
                    {[1, 2, 3].map(lightNum => (
                      <div key={lightNum} className="flex flex-col items-center">
                        <div className="number-circle text-lg font-bold mb-2 text-white bg-gradient-to-br from-purple-500 to-pink-500 rounded-full shadow-lg" style={{width: '32px', height: '32px', display: 'flex', alignItems: 'center', justifyContent: 'center'}}>
                          <span className="number-text" style={{lineHeight: '1', display: 'block', transform: 'translateY(-2px)'}}>{lightNum}</span>
                        </div>
                        <div className="bg-gradient-to-br from-gray-900 to-gray-800 rounded-3xl p-3 flex flex-col gap-3 shadow-2xl border-2 border-gray-700 hover:border-gray-600 transition-all">
                          {lights[lightNum].map((color, position) => (
                            <DrawableCircle
                              key={position}
                              color={color}
                              selectedColor={selectedColor}
                              onColorFill={() => fillLight(lightNum, position)}
                            />
                          ))}
                        </div>
                        <div className="w-3 h-14 bg-gradient-to-b from-gray-700 to-gray-800 mt-1 shadow-lg"></div>
                        <div className="w-16 h-3 bg-gradient-to-b from-green-600 to-green-700 rounded-t shadow-lg"></div>
                      </div>
                    ))}
                  </div>
                  <p className="text-xs text-slate-300 mt-5 text-center bg-white/5 rounded-lg py-2 px-3 backdrop-blur bottom-instruction">
                    {selectedColor 
                      ? 'üé® Click any white circle to fill it with the selected color'
                      : '‚úèÔ∏è Draw inside any circle with your mouse or finger'}
                  </p>
                </div>
              </div>
            </div>
          </div>
        </div>
      );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<TrafficLightApp />);
  </script>
</body>
</html>